@page
@model Asm_PRN222_QuizGame.Admin.Pages.Host_Page.HostPageModel
@{
    ViewData["Title"] = "Host Page";
}

<h3>Host Page</h3>

<div id="host-ui">
    <button id="startBtn">Start Game</button>
    <h4 id="questionText">Current Question:</h4>
    <ul id="options"></ul>

    <h4>Scoreboard</h4>
    <ul id="scoreboard"></ul>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/gameHub")
            .build();

        connection.on("NextQuestion", data => {
            document.getElementById("questionText").innerText = "Question: " + data.questionText;
            const optionsEl = document.getElementById("options");
            optionsEl.innerHTML = "";
            for (const key in data.options) {
                const li = document.createElement("li");
                li.innerText = key + ": " + data.options[key];
                optionsEl.appendChild(li);
            }
        });

        connection.on("UpdateScoreboard", data => {
            const board = document.getElementById("scoreboard");
            board.innerHTML = "";
            data.forEach(player => {
                const li = document.createElement("li");
                li.innerText = JSON.stringify(player);
                board.appendChild(li);
            });
        });

        connection.start().then(() => {
            document.getElementById("startBtn").onclick = () => {
                connection.invoke("StartGame", 1);
            };
        });
    </script>
}